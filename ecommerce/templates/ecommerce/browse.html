{% extends 'ecommerce/base.html' %}
{% load staticfiles %}
{% load basket_tags %}
{% load promotion_tags %}
{% load category_tags %}
{% load product_tags %}
{% load rootcategories_tags %}
{% load currency_filters %}
{% load purchase_info_tags %}
{% load i18n %}

{% block content %}
  <div class="container visible-md visible-lg">
    <div class="row">
      <ul class="nav navbar-nav">
      {% root_categories as roots %}
        {% for root in roots %}
        <li class="dropdown" id="menuitem{{root.id}}">
          <a href="#" role="button" aria-haspopup="true" aria-expanded="false">{{ root.name }}<span class="caret"></span></a>
        </li>
        {% endfor %}
      </ul>
    </div>
    {% for root in roots %}
    <div class="row hidden jdi-dropdown-content" id="dropdownmenuitem{{root.id}}">
      {% for category in root.get_children %}
      <div class="col-xs-6 col-sm-4 col-md-3 col-lg-3">
        <h3>{{ category.name }}</h3><br>
        {% for subcategory in category.get_children %}
        <a href={{ subcategory.get_absolute_url }}>{{ subcategory.name }}</a><br>
        {% endfor %}
        <br>
      </div>
      {% endfor %}
    </div>
    {% endfor %}
  </div>
  <div class="container">
    <ul class="breadcrumb">
        <li><a href="{{ homepage_url }}">Home</a></li>
        <li class="active">{{ summary }}</li>
    </ul>
  </div>
    <div class="container">
        <form method="get" action="{% url 'search:search' %}" class="navbar-form navbar-right">
            <div class="form-group">
            {{ search_form.q }}
            </div>
            <input type="submit" value="{% trans "Search" %}" class="btn btn-default" />
        </form>
    </div>
<div class="container">
<div class="basket-mini pull-right hidden-xs">
    <strong>{% trans "Basket total:" %}</strong>
    {% if request.basket.is_tax_known %}
        {{ request.basket.total_incl_tax|currency:request.basket.currency }}
    {% else %}
        {{ request.basket.total_excl_tax|currency:request.basket.currency }}
    {% endif %}

    <span class="btn-group">
        <a class="btn btn-default" href="{% url 'basket:summary' %}">{% trans "View basket" %}</a>
        <button class="btn btn-default dropdown-toggle" data-toggle="dropdown">
            <span class="caret"></span>
        </button>
        <ul class="dropdown-menu pull-right">
            <li>{% include "basket/partials/basket_quick.html" %}</li>
        </ul>
    </span>
</div>
    </div>
    <div class="container">
  <form method="get" class="form-horizontal">
        {# Render other search params in a hidden block #}
        <div style="display:none">
            {% for value in selected_facets %}
                <input name="selected_facets" value="{{ value }}" />
            {% endfor %}
            {{ form.q }}
        </div>

        {% if paginator.count %}
            {% if paginator.num_pages > 1 %}
                {% blocktrans with start=page_obj.start_index end=page_obj.end_index count num_results=paginator.count %}
                    <strong>{{ num_results }}</strong> result - showing <strong>{{ start }}</strong> to <strong>{{ end }}</strong>.
                {% plural %}
                    <strong>{{ num_results }}</strong> results - showing <strong>{{ start }}</strong> to <strong>{{ end }}</strong>.
                {% endblocktrans %}
            {% else %}
                {% blocktrans count num_results=paginator.count %}
                    <strong>{{ num_results }}</strong> result.
                {% plural %}
                    <strong>{{ num_results }}</strong> results.
                {% endblocktrans %}
            {% endif %}
            {% if form %}
                <div class="pull-right">
                    {% include "partials/form_field.html" with field=form.sort_by %}
                </div>
            {% endif %}
        {% else %}
            <p>
                {% trans "<strong>0</strong> results." %}
            </p>
        {% endif %}
    </form>

    {% if products %}
        <div class="row">
            {% for product in products %}
                <div class="col-xs-6 col-sm-4 col-md-3 col-lg-3 thumbnail">
                    <a href="{{ product.get_absolute_url }}">
                        <p>
                          <img src="{% static 'ecommerce/img/Thumbnail_Placeholder.png' %}" alt="{{ product.get_title }}"/>
                        </p>
                    <h3>{{ product.get_title|truncatewords:4 }}</h3>
                    {% purchase_info_for_product request product as session %}
                    {% if session.price.exists %}
                        {% if session.price.excl_tax == 0 %}
                            <p class="price_color">{% trans "Free" %}</p>
                        {% elif session.price.is_tax_known %}
                            <p class="price_color">{{ session.price.incl_tax|currency:session.price.currency }}</p>
                        {% else %}
                            <p class="price_color">{{ session.price.excl_tax|currency:session.price.currency }}</p>
                        {% endif %}
                    {% else %}
                        <p class="price_color">&nbsp;</p>
                    {% endif %}
                  </a>
                    {% if not product.is_parent %}
                        {% if session.availability.is_available_to_buy %}
                        {% basket_form request product 'single' as basket_form %}
                            <form action="{% url 'basket:add' pk=product.pk %}" method="post">
                                {% csrf_token %}
                                {{ basket_form.as_p }}
                                <button type="submit" class="btn btn-primary btn-block" data-loading-text="{% trans 'Adding...' %}">{% trans "Add to basket" %}</button>
                            </form>
                        {% else %}
                            <span class="btn btn-default btn-block disabled">{% trans "Add to basket" %}</span>
                        {% endif %}
                    {% endif %}
                </div>
            {% endfor %}
        </div>
        <div class="row">
            {% include "partials/pagination.html" %}
        </div>
    {% else %}
        <div class="row">
        <p class="nonefound">{% trans "No products found." %}</p>
        </div>
    {% endif %}
    </div>
{% endblock %}
